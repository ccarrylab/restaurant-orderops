apiVersion: apps/v1
kind: Deployment
metadata: {name: restaurant-api, labels: {app: restaurant-api}}
spec:
  replicas: 3
  selector: {matchLabels: {app: restaurant-api}}
  template:
    metadata: {labels: {app: restaurant-api}}
    spec:
      containers:
      - name: restaurant-api
        image: ccarrylab/restaurant-api:latest
        ports: [{containerPort: 8080}]
        env: [{name: PORT, value: "8080"}]
        resources: {requests: {cpu: 100m, memory: 128Mi}, limits: {cpu: 500m, memory: 512Mi}}
        livenessProbe: {httpGet: {path: /health, port: 8080}, initialDelaySeconds: 10}
        readinessProbe: {httpGet: {path: /ready, port: 8080}, initialDelaySeconds: 5}
---
apiVersion: v1
kind: Service
metadata: {name: restaurant-api}
spec: {selector: {app: restaurant-api}, ports: [{protocol: TCP, port: 80, targetPort: 8080}]}
